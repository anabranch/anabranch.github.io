<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>WorldCupChatter.com - Graphing Tweets in Real Time</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/css/normalize.css">
        <link rel="stylesheet" href="/css/skeleton.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/github.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
              <div class="row">
   <div class="twelve columns personal-intro" style="height:10px;">
   </div>
</div>
<div class="row">
   <div class="one offset-by-three columns nav-blocks">
      <a onmouseover="vis_on('hhm');" onmouseout="vis_off('hhm');" href="/"><i class="mdi mdi-home"></i></a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('hab');" onmouseout="vis_off('hab');" href="/about.html"><i class="mdi mdi-account"></i></a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('hes');" onmouseout="vis_off('hes');" href="/essays.html"><i class="mdi mdi-file-document"></i></a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('hpr');" onmouseout="vis_off('hpr');" href="/projects.html"><i class="mdi mdi-beaker"></i></a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('htu');" onmouseout="vis_off('htu');" href="/tutorials.html"><i class="mdi mdi-cog"></i></a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('hem');" onmouseout="vis_off('hem');" href="mailto:wchambers@ischool.berkeley.edu"><i class="mdi mdi-email"></i></a>
   </div>
</div>
<div class="row">
   <div class="one offset-by-three columns nav-blocks">
      <a onmouseover="vis_on('hhm');" onmouseout="vis_off('hhm');" id='hhm' class='sibling' href="/">home</a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('hab');" onmouseout="vis_off('hab');" id='hab' class='sibling' href="/about.html">about</a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('hes');" onmouseout="vis_off('hes');" id='hes' class='sibling' href="/essays.html">essays</a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('hpr');" onmouseout="vis_off('hpr');" id='hpr' class='sibling' href="/projects.html">projects</a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('htu');" onmouseout="vis_off('htu');" id='htu' class='sibling' href="/tutorials.html">tutorials</a>
   </div>
   <div class="one columns nav-blocks">
      <a onmouseover="vis_on('hem');" onmouseout="vis_off('hem');" id='hem' class='sibling' href="mailto:wchambers@ischool.berkeley.edu">email</a>
   </div>
</div>

              <div class="row">
   <div class="ten offset-by-one columns">
      <article class="post">
         <div class='titles'>
            <h4>WorldCupChatter.com - Graphing Tweets in Real Time</h4>
            <p class="meta">
               <!-- <span class='tags'>
                  Tags:
                  
                  
                  </span> -->
               <span class='date'>
               15 June 2014
               </span>
            </p>
         </div>
         <p><em>During the World Cup of 2014, I wrote a twitter bot that read tweets about the world cup, associated them with teams then graphed them out in real time.</em></p>

<p>This was my first production experience with Node.js. There Are definitely some really interesting things about JavaScript on the backend that allow you to take advantage of events. That is namely what I tried to do with this project. Learn a little bit more about node.js, about streaming data and analysis, and offloading responsibility to the client.</p>

<p>The framework I used was <a href="http://socket.io/">socket.io</a>. My knowledge is certainly introductory but it provided a simple way for me to communicate real time data between the client&#39;s browser as well as the server. I wrote up a small intro on the site to allow people to understand what was happening</p>

<p><img src="/assets/world_cup_chatter_intro.jpg" alt="World Cup Chatter Graph"></p>

<h3>The Code</h3>

<hr>

<p>The server is incredibly simple and essentially boils down to this code:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Connected...&quot;</span><span class="p">);</span>
    <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tweet</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;new tweet&#39;</span><span class="p">,</span> <span class="nx">tweet</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;TWEET&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>With that server running we run everything else using D3.js to graph our tweets. The client runs a heavily modified version of <a href="http://bost.ocks.org/mike/path/">Mike Bostock&#39;s path transitions examples</a>. Concretely, every time the client receives a tweet from the server it pushes it to a list. </p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;new tweet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tweet</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">tweet</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parseTwitterDate</span><span class="p">(</span><span class="nx">tweet</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">]);</span>
   <span class="nx">master_tweet_list</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tweet</span><span class="p">);</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Received Tweet&quot;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>That list is then filtered (did the tweet occur in the last second) and pushed onto the relevant list every &#39;tick&#39;, or every second. </p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">master_tweet_list</span> <span class="o">=</span> <span class="nx">master_tweet_list</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">within1Second2</span><span class="p">)</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">master_tweet_list</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</code></pre></div>
<p>This all produces a graph like this as time continues.</p>

<p><img src="/assets/world_cup_chatter.jpeg" alt="World Cup Chatter Graph"></p>

<p>What&#39;s nice is D3.js provides us with some nice smoothing abilities, this allows us to smooth out the animation when we append to the list, the code is this. It&#39;s important to know that the x-axis moves with our data.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">scale</span><span class="p">()</span>
   <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="nx">now</span> <span class="o">-</span> <span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">duration</span><span class="p">,</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">duration</span><span class="p">])</span>
   <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">]);</span>
</code></pre></div>
<p>Beyond this, the code is more or less boilerplate. Obviously there&#39;s some styling, some rolling up of the layout but more or less everything important was happening here.</p>

<h3>Challenges &amp; Conclusions</h3>

<hr>

<p>Real-time data is hard. Period. Twitter scale is also hard. Period.</p>

<p>I didn&#39;t have a lot of money to shell out for the server at this point so sending information to more than 10-15 clients at once reduced the ability for my server to send out tweets effectively to all clients. </p>

<p>Another issue was memory leaks. When I would leave my browser open for an extended period of time, I found quality and degradation in my map and pushing functions. Trying to analyze the time of 10,000 tweets at once was difficult for a browser and took longer than a second. This caused my graphs to be off at certain periods of time.</p>

<p><a href="https://github.com/anabranch/World-Cup-Chatter">Check out the project on Github.</a></p>

      </article>
   </div>
</div>

              <div class="footer">
   <!-- <h1>The Portfolio & Writings of Bill Chambers</h1> -->
   <!-- <h3>Internal Navigation</h3> -->
   <div class="row">
      <div class="one offset-by-two columns nav-blocks">
         <a onmouseover="vis_on('fhm');" onmouseout="vis_off('fhm');" href="/"><i class="mdi mdi-home"></i></a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fab');" onmouseout="vis_off('fab');" href="/about.html"><i class="mdi mdi-account"></i></a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fes');" onmouseout="vis_off('fes');" href="/essays.html"><i class="mdi mdi-file-document"></i></a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fpr');" onmouseout="vis_off('fpr');" href="/projects.html"><i class="mdi mdi-beaker"></i></a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('ftu');" onmouseout="vis_off('ftu');" href="/tutorials.html"><i class="mdi mdi-cog"></i></a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fli');" onmouseout="vis_off('fli');" href="https://www.linkedin.com/in/wachambers"><i class="mdi mdi-linkedin"></i></a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fgh');" onmouseout="vis_off('fgh');" href="http://github.com/anabranch/"><i class="mdi mdi-github-box"></i></a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('ftw');" onmouseout="vis_off('ftw');" href="http://twitter.com/b_a_chambers/"><i class="mdi mdi-twitter-box"></i></a>
      </div>
   </div>
   <div class="row">
      <div class="one offset-by-two columns nav-blocks">
         <a onmouseover="vis_on('fhm');" onmouseout="vis_off('fhm');" id='fhm' class='sibling' href="/">home</a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fab');" onmouseout="vis_off('fab');" id='fab' class='sibling' href="/about.html">about</a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fes');" onmouseout="vis_off('fes');" id='fes' class='sibling' href="/essays.html">essays</a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fpr');" onmouseout="vis_off('fpr');" id='fpr' class='sibling' href="/projects.html">projects</a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('ftu');" onmouseout="vis_off('ftu');" id='ftu' class='sibling' href="/tutorials.html">tutorials</a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fli');" onmouseout="vis_off('fli');" id='fli' class='sibling' href="https://www.linkedin.com/in/wachambers">linkedin</a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('fgh');" onmouseout="vis_off('fgh');" id='fgh' class='sibling' href="http://github.com/anabranch/">github</a>
      </div>
      <div class="one columns nav-blocks">
         <a onmouseover="vis_on('ftw');" onmouseout="vis_off('ftw');" id='ftw' class='sibling' href="http://twitter.com/b_a_chambers/">twitter</a>
      </div>
   </div>
</div>

        </div> <!-- /container -->
    </body>

<script charset="utf-8">
var hovered_el;
function vis_on(id) {
    var e = document.getElementById(id);
        e.style.display = 'block';
    var siblings = document.getElementsByClassName("sibling");
    hovered_el = e;
    for (var i = 0; i < siblings.length; i++) {
        if (siblings[i].id !== id) {
            siblings[i].style.display = 'none';
        }
    }
}

function vis_off(id) {
    hovered_el = undefined;
    setTimeout(function(){
        if (hovered_el == undefined) {
            var e = document.getElementById(id);
                e.style.display = 'none';
        }
    }, 400);
}

setTimeout(function(){
["hhm","hab","hes","hpr","htu","hem", 'fhm', 'fab', 'fes', 'fpr', 'ftu', 'fli', 'fgh', 'ftw'].map(vis_off)
}, 1000);

                        </script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64737356-1', 'auto');
  ga('send', 'pageview');

  </script>
</html>
