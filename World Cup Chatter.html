<!DOCTYPE html>
<html lang="en">
<head>
        <title>WorldCupChatter.com - Graphing Tweets in Real Time</title>
        <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="shortcut icon" href="http://launchyard.com/images/favicon.png"/>
        <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://www.anabranch.me/css/ie.css"/>
                <script src="http://www.anabranch.me/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://www.anabranch.me/css/ie6.css"/><![endif]-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js" type="text/javascript"></script>


</head>

<body id="index" class="home">
<a href="https://www.github.com/anabranch">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
	
	      <div class="l-detail"><p><img src="/static/anabranch.jpg" width="140" height="140" alt="Anabranching River"><br/>
            <a href="http://www.anabranch.me/index.html">Home</a> | <a href="http://www.anabranch.me/about.html">About</a> | <a href="http://www.anabranch.me/category/articles.html">Thoughts</a> | <a href="http://www.anabranch.me/category/projects.html">Projects</a> </p></div>
<section id="content" >
    <div class="body">
      <article>
        <header>
          <h1 class="entry-title">
            <a href="http://www.anabranch.me/World Cup Chatter.html" rel="bookmark"
               title="Permalink to WorldCupChatter.com - Graphing Tweets in Real Time">WorldCupChatter.com - Graphing Tweets in Real Time</a></h1>

        </header>

        <div class="entry-content">
<div class="post-info">
	<ul>
        <li class="vcard author">
                 by&nbsp;<a class="url fn" href="http://www.anabranch.me/author/bill-chambers.html">Bill Chambers</a>
        </li>
        <li class="published" title="2014-09-15T00:00:00">
          on&nbsp;Mon 15 September 2014
        </li>

	</ul>
<p>Tags: <a href="http://www.anabranch.me/tag/world-cup.html">World Cup</a>  <a href="http://www.anabranch.me/tag/twitter.html">Twitter</a>  <a href="http://www.anabranch.me/tag/nodejs.html">Node.js</a>  <a href="http://www.anabranch.me/tag/d3js.html">D3.js</a>  </p></div><!-- /.post-info -->
<p><em>During the World Cup of 2014, I wrote a twitter bot that read tweets about the world cup, associated them with teams then graphed them out in real time.</em></p>          <p>This was my first production experience with Node.js. There Are definitely some really interesting things about JavaScript on the backend that allow you to take advantage of events. That is namely what I tried to do with this project. Learn a little bit more about node.js, about streaming data and analysis, and offloading responsibility to the client.</p>
<p>The framework I used was <a href="http://socket.io/">socket.io</a>. My knowledge is certainly introductory but it provided a simple way for me to communicate real time data between the client's browser as well as the server. I wrote up a small intro on the site to allow people to understand what was happening</p>
<p><img alt="World Cup Chatter Graph" src="/static/world_cup_chatter_intro.jpg" /></p>
<h3>The Code</h3>
<p>The server is incredibly simple and essentially boils down to this code:</p>
<div class="highlight"><pre><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Connected...&quot;</span><span class="p">);</span>
    <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;tweet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tweet</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;new tweet&#39;</span><span class="p">,</span> <span class="nx">tweet</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;TWEET&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>With that server running we run everything else using D3.js to graph our tweets. The client runs a heavily modified version of <a href="http://bost.ocks.org/mike/path/">Mike Bostock's path transitions examples</a>. Concretely, every time the client receives a tweet from the server it pushes it to a list. </p>
<div class="highlight"><pre><span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;new tweet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tweet</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tweet</span><span class="cp">[</span><span class="s1">&#39;created_at&#39;</span><span class="cp">]</span> <span class="o">=</span> <span class="nx">parseTwitterDate</span><span class="p">(</span><span class="nx">tweet</span><span class="cp">[</span><span class="s1">&#39;created_at&#39;</span><span class="cp">]</span><span class="p">);</span>
    <span class="nx">master_tweet_list</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tweet</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Received Tweet&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>That list is then filtered (did the tweet occur in the last second) and pushed onto the relevant list every 'tick', or every second. </p>
<div class="highlight"><pre><span class="n">master_tweet_list</span> <span class="o">=</span> <span class="n">master_tweet_list</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">within1Second2</span><span class="p">)</span>
<span class="n">data</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">master_tweet_list</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
</pre></div>


<p>This all produces a graph like this as time continues.</p>
<p><img alt="World Cup Chatter Graph" src="/static/world_cup_chatter.jpeg" /></p>
<p>What's nice is D3.js provides us with some nice smoothing abilities, this allows us to smooth out the animation when we append to the list, the code is this. It's important to know that the x-axis moves with our data.</p>
<div class="highlight"><pre><span class="n">var</span> <span class="n">x</span> <span class="o">=</span> <span class="n">d3</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">scale</span><span class="p">()</span>
    <span class="p">.</span><span class="n">domain</span><span class="p">([</span><span class="n">now</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">duration</span><span class="p">,</span> <span class="n">now</span> <span class="o">-</span> <span class="n">duration</span><span class="p">])</span>
    <span class="p">.</span><span class="n">range</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">]);</span>
</pre></div>


<p>Beyond this, the code is more or less boilerplate. Obviously there's some styling, some rolling up of the layout but more or less everything important was happening here.</p>
<h3>Challenges &amp; Take-Aways</h3>
<p>Real-time data is hard. Period. Twitter scale is also hard. Period.</p>
<p>I didn't have a lot of money to shell out for the server at this point so sending information to more than 10-15 clients at once reduced the ability for my server to send out tweets effectively to all clients. </p>
<p>Another issue was memory leaks. When I would leave my browser open for an extended period of time, I found quality and degradation in my map and pushing functions. Trying to analyze the time of 10,000 tweets at once was difficult for a browser and took longer than a second. This caused my graphs to be off at certain periods of time.</p>
<p>There are so many small little issues that come up in programming that end up having significant implications.</p>
<p><a href="https://github.com/anabranch/World-Cup-Chatter">Check out the project on Github.</a></p>
        </div><!-- /.entry-content -->

      </article>
    </div>
</section>
        <section id="extras" >
       
        
        </section><!-- /#extras -->
	
        <footer id="contentinfo" >
                <address id="about" class="vcard ">
                Proudly powered by <a href="http://getpelican.com/" target="_blank">Pelican</a>, which takes
                great advantage of <a href="http://python.org" target="_blank">Python</a>. &copy; <a class="url fn" href="http://anabranch.me">Bill Chambers</a>
		
                </address><!-- /#about -->
		

                
        </footer><!-- /#contentinfo -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54337529-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>